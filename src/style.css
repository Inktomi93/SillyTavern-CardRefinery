/* =============================================================================
   CHARACTER TOOLS EXTENSION - CSS DESIGN SYSTEM
   =============================================================================
   Mobile-first, ST-native design system that inherits SillyTavern's theming.

   ARCHITECTURE:
   1. Design Tokens (CSS Variables) - Inherit from ST, define our spacing scale
   2. Base Reset & Typography - Normalize within our popup
   3. Layout Primitives - Flex/grid utilities for composition
   4. Component Styles - BEM-namespaced UI patterns
   5. Responsive Overrides - Mobile-first breakpoints
   ============================================================================= */

/* =============================================================================
   1. DESIGN TOKENS
   =============================================================================
   We inherit ST's SmartTheme variables for colors/fonts and define our own
   spacing scale. This ensures theme compatibility while maintaining consistency.
   ============================================================================= */

/* Design tokens shared by all CT components */
.ct-popup,
.ct-settings-modal,
.ct-drawer {
    /* ─────────────────────────────────────────────────────────────────────────
       COLORS - Inherit from SillyTavern SmartTheme
       ───────────────────────────────────────────────────────────────────────── */

    /* Backgrounds */
    --ct-bg: var(--SmartThemeBlurTintColor);
    --ct-bg-secondary: var(--black30a, rgba(0, 0, 0, 0.3));
    --ct-bg-tertiary: var(--black50a, rgba(0, 0, 0, 0.5));
    --ct-bg-elevated: color-mix(
        in srgb,
        var(--SmartThemeBlurTintColor) 90%,
        white 10%
    );

    /* Text */
    --ct-text: var(--SmartThemeBodyColor);
    --ct-text-muted: color-mix(
        in srgb,
        var(--SmartThemeBodyColor) 70%,
        transparent
    );
    --ct-text-dim: color-mix(
        in srgb,
        var(--SmartThemeBodyColor) 50%,
        transparent
    );

    /* Borders */
    --ct-border: var(--SmartThemeBorderColor);
    --ct-border-muted: color-mix(
        in srgb,
        var(--SmartThemeBorderColor) 50%,
        transparent
    );

    /* Accent */
    --ct-accent: var(--SmartThemeQuoteColor);
    --ct-accent-hover: color-mix(
        in srgb,
        var(--SmartThemeQuoteColor) 80%,
        white
    );
    --ct-accent-muted: color-mix(
        in srgb,
        var(--SmartThemeQuoteColor) 30%,
        transparent
    );

    /* Semantic Colors */
    --ct-success: var(--okGreen70a, #4caf50);
    --ct-success-bg: color-mix(
        in srgb,
        var(--okGreen70a, #4caf50) 15%,
        transparent
    );
    --ct-warning: var(--golden, #ff9800);
    --ct-warning-bg: color-mix(
        in srgb,
        var(--golden, #ff9800) 15%,
        transparent
    );
    --ct-danger: var(--fullred, #f44336);
    --ct-danger-bg: color-mix(
        in srgb,
        var(--fullred, #f44336) 15%,
        transparent
    );

    /* ─────────────────────────────────────────────────────────────────────────
       SPACING SCALE - 4px base, follows 4-8-12-16-20-24-32-48 progression
       ───────────────────────────────────────────────────────────────────────── */
    --ct-space-1: 0.25rem; /* 4px - tight gaps, icon padding */
    --ct-space-2: 0.5rem; /* 8px - default gap, small padding */
    --ct-space-3: 0.75rem; /* 12px - section padding, medium gap */
    --ct-space-4: 1rem; /* 16px - large padding, section gap */
    --ct-space-5: 1.25rem; /* 20px - header padding */
    --ct-space-6: 1.5rem; /* 24px - major section separation */
    --ct-space-8: 2rem; /* 32px - panel gaps */
    --ct-space-12: 3rem; /* 48px - major layout spacing */

    /* ─────────────────────────────────────────────────────────────────────────
       TYPOGRAPHY - Inherit from ST, define scales
       ───────────────────────────────────────────────────────────────────────── */
    --ct-font: var(--mainFontFamily, system-ui, -apple-system, sans-serif);
    --ct-font-mono: var(--monoFontFamily, 'Consolas', 'Monaco', monospace);
    --ct-font-size: var(--mainFontSize, 1rem);

    /* Font size scale */
    --ct-text-xs: calc(var(--ct-font-size) * 0.75); /* 12px @ 16px base */
    --ct-text-sm: calc(var(--ct-font-size) * 0.875); /* 14px */
    --ct-text-base: var(--ct-font-size); /* 16px */
    --ct-text-lg: calc(var(--ct-font-size) * 1.125); /* 18px */
    --ct-text-xl: calc(var(--ct-font-size) * 1.25); /* 20px */

    /* ─────────────────────────────────────────────────────────────────────────
       RADII - Match ST's rounded aesthetic
       ───────────────────────────────────────────────────────────────────────── */
    --ct-radius-sm: 4px;
    --ct-radius: 8px;
    --ct-radius-lg: 12px;
    --ct-radius-pill: 9999px;

    /* ─────────────────────────────────────────────────────────────────────────
       SHADOWS & EFFECTS
       ───────────────────────────────────────────────────────────────────────── */
    --ct-shadow-sm: 0 1px 3px var(--black30a, rgba(0, 0, 0, 0.3));
    --ct-shadow: 0 4px 12px var(--black30a, rgba(0, 0, 0, 0.3));
    --ct-shadow-lg: 0 8px 24px var(--black50a, rgba(0, 0, 0, 0.5));

    /* Transitions - use ST's animation-duration */
    --ct-transition-fast: var(--animation-duration, 150ms) ease;
    --ct-transition: var(--animation-duration-slow, 300ms) ease;

    /* ─────────────────────────────────────────────────────────────────────────
       LAYOUT TOKENS
       ───────────────────────────────────────────────────────────────────────── */
    --ct-panel-min: 280px;
    --ct-panel-max: 480px;
    --ct-header-height: 48px;
}

/* =============================================================================
   2. BASE RESET & TYPOGRAPHY
   =============================================================================
   Normalize elements within our popup container for consistent rendering.
   ============================================================================= */

.ct-popup {
    /* Use ST's native font settings */
    font-family: var(--ct-font);
    font-size: var(--ct-font-size);
    color: var(--ct-text);
    line-height: 1.5;

    /* Box sizing reset */
    box-sizing: border-box;
}

.ct-popup *,
.ct-popup *::before,
.ct-popup *::after {
    box-sizing: inherit;
}

/* Headings */
.ct-popup h1,
.ct-popup h2,
.ct-popup h3,
.ct-popup h4 {
    margin: 0;
    font-weight: 600;
    line-height: 1.3;
    color: var(--ct-text);
}

.ct-popup h2 {
    font-size: var(--ct-text-lg);
}
.ct-popup h3 {
    font-size: var(--ct-text-base);
}
.ct-popup h4 {
    font-size: var(--ct-text-sm);
}

/* Links */
.ct-popup a {
    color: var(--ct-accent);
    text-decoration: none;
}

.ct-popup a:hover {
    text-decoration: underline;
}

/* =============================================================================
   3. LAYOUT PRIMITIVES
   =============================================================================
   Composable flex utilities for building layouts. These complement ST's
   existing utilities and follow similar naming patterns.
   ============================================================================= */

/* Stack: Vertical flex layout with consistent gap */
.ct-stack {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-3);
}

.ct-stack--tight {
    gap: var(--ct-space-2);
}
.ct-stack--loose {
    gap: var(--ct-space-4);
}

/* Row: Horizontal flex layout */
.ct-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-row--wrap {
    flex-wrap: wrap;
}
.ct-row--between {
    justify-content: space-between;
}
.ct-row--end {
    justify-content: flex-end;
}
.ct-row--stretch {
    align-items: stretch;
}

/* Grid layouts */
.ct-grid {
    display: grid;
    gap: var(--ct-space-3);
}

.ct-grid--2col {
    grid-template-columns: repeat(2, 1fr);
}

@media (max-width: 600px) {
    .ct-grid--2col {
        grid-template-columns: 1fr;
    }
}

/* Flex children utilities */
.ct-flex-1 {
    flex: 1 1 0%;
}
.ct-flex-auto {
    flex: 1 1 auto;
}
.ct-flex-none {
    flex: none;
}
.ct-shrink-0 {
    flex-shrink: 0;
}

/* Spacing utilities - use these in HTML when one-offs are needed */
.ct-gap-1 {
    gap: var(--ct-space-1);
}
.ct-gap-2 {
    gap: var(--ct-space-2);
}
.ct-gap-3 {
    gap: var(--ct-space-3);
}
.ct-gap-4 {
    gap: var(--ct-space-4);
}

.ct-p-2 {
    padding: var(--ct-space-2);
}
.ct-p-3 {
    padding: var(--ct-space-3);
}
.ct-p-4 {
    padding: var(--ct-space-4);
}

.ct-mt-2 {
    margin-top: var(--ct-space-2);
}
.ct-mt-3 {
    margin-top: var(--ct-space-3);
}
.ct-mt-4 {
    margin-top: var(--ct-space-4);
}
.ct-mt-auto {
    margin-top: auto;
}

.ct-mb-2 {
    margin-bottom: var(--ct-space-2);
}
.ct-mb-3 {
    margin-bottom: var(--ct-space-3);
}
.ct-mb-4 {
    margin-bottom: var(--ct-space-4);
}

.ct-ml-auto {
    margin-left: auto;
}
.ct-mr-auto {
    margin-right: auto;
}

/* Width utilities */
.ct-w-full {
    width: 100%;
}
.ct-min-w-0 {
    min-width: 0;
}

/* Overflow handling */
.ct-overflow-auto {
    overflow: auto;
}
.ct-overflow-hidden {
    overflow: hidden;
}
.ct-overflow-y-auto {
    overflow-y: auto;
}

/* Scrollable container with styled scrollbar */
.ct-scrollable {
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--ct-border) transparent;
}

.ct-scrollable::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.ct-scrollable::-webkit-scrollbar-track {
    background: transparent;
}

.ct-scrollable::-webkit-scrollbar-thumb {
    background: var(--ct-border);
    border-radius: var(--ct-radius-pill);
}

.ct-scrollable::-webkit-scrollbar-thumb:hover {
    background: var(--ct-accent);
}

/* Text utilities */
.ct-text-muted {
    color: var(--ct-text-muted);
}
.ct-text-dim {
    color: var(--ct-text-dim);
}
.ct-text-accent {
    color: var(--ct-accent);
}
.ct-text-success {
    color: var(--ct-success);
}
.ct-text-warning {
    color: var(--ct-warning);
}
.ct-text-danger {
    color: var(--ct-danger);
}

.ct-text-xs {
    font-size: var(--ct-text-xs);
}
.ct-text-sm {
    font-size: var(--ct-text-sm);
}
.ct-text-lg {
    font-size: var(--ct-text-lg);
}

.ct-text-mono {
    font-family: var(--ct-font-mono);
}
.ct-text-center {
    text-align: center;
}
.ct-text-right {
    text-align: right;
}
.ct-font-medium {
    font-weight: 500;
}
.ct-font-semibold {
    font-weight: 600;
}

/* Truncation */
.ct-truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Visual utilities */
.ct-hidden {
    display: none !important;
}
.ct-sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* =============================================================================
   4. COMPONENT STYLES
   =============================================================================
   BEM-namespaced components. Use ST's .menu_button for buttons.
   ============================================================================= */

/* ─────────────────────────────────────────────────────────────────────────────
   POPUP CONTAINER
   Mobile-first: full viewport, then constrain on larger screens
   ───────────────────────────────────────────────────────────────────────────── */

.ct-popup {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    min-height: 400px;
    max-height: 95dvh;
    background: var(--ct-bg);
    border-radius: var(--ct-radius-lg);
    overflow: hidden;
}

/* Override ST popup sizing for our extension */
.popup:has(.ct-popup) {
    width: 95dvw;
    max-width: 1200px;
    height: 90dvh;
    max-height: none;
    padding: 0;
}

@media (max-width: 768px) {
    .popup:has(.ct-popup) {
        width: 100dvw;
        height: 100dvh;
        max-width: none;
        border-radius: 0;
    }
}

/* ─────────────────────────────────────────────────────────────────────────────
   HEADER - Three-column layout with character selector
   ───────────────────────────────────────────────────────────────────────────── */

.ct-header {
    position: relative; /* Establish stacking context for dropdown */
    z-index: 100; /* Above toolbar */
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    min-height: var(--ct-header-height);
    padding: var(--ct-space-2) var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
    gap: var(--ct-space-3);
}

.ct-header__left {
    display: flex;
    align-items: center;
    justify-content: flex-start;
}

.ct-header__center {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--ct-space-2);
}

.ct-header__center i {
    color: var(--ct-accent);
    font-size: var(--ct-text-lg);
}

.ct-header__center h2 {
    font-size: var(--ct-text-base);
    font-weight: 600;
    white-space: nowrap;
}

.ct-header__right {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--ct-space-2);
}

/* Legacy support */
.ct-header__title {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-header__title i {
    color: var(--ct-accent);
    font-size: var(--ct-text-lg);
}

.ct-header__actions {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

/* ─────────────────────────────────────────────────────────────────────────────
   API STATUS BADGE - Shows current connection status
   ───────────────────────────────────────────────────────────────────────────── */

.ct-api-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--ct-space-1);
    padding: var(--ct-space-1) var(--ct-space-2);
    background: var(--ct-success-bg);
    border-radius: var(--ct-radius-pill);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-muted);
    cursor: default;
    transition: background var(--ct-transition-fast);
}

.ct-api-badge--error {
    background: var(--ct-danger-bg);
}

.ct-api-badge i {
    font-size: 0.625rem;
}

.ct-text-success {
    color: var(--ct-success);
}

.ct-text-danger {
    color: var(--ct-danger);
}

/* Full API status component (for settings/expanded view) */
.ct-api-status {
    display: flex;
    align-items: center;
    gap: var(--ct-space-3);
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
    border: 1px solid var(--ct-border-muted);
}

.ct-api-status--ready {
    border-color: var(--ct-success);
}

.ct-api-status--error {
    border-color: var(--ct-danger);
}

.ct-api-status__indicator {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-api-status__text {
    font-size: var(--ct-text-sm);
    font-weight: 500;
}

.ct-api-status__error {
    color: var(--ct-danger);
    cursor: help;
}

/* ─────────────────────────────────────────────────────────────────────────────
   TOOLBAR - Stage tabs + pipeline controls
   ───────────────────────────────────────────────────────────────────────────── */

.ct-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2) var(--ct-space-3);
    padding: var(--ct-space-2) var(--ct-space-4);
    background: var(--ct-bg-tertiary);
    border-bottom: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
    flex-wrap: wrap;
}

/* When toolbar wraps, give each row proper spacing */
@media (max-width: 900px) {
    .ct-toolbar {
        gap: var(--ct-space-2);
    }
}

.ct-toolbar__controls {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    flex-wrap: wrap;
    flex-shrink: 0;
}

/* ─────────────────────────────────────────────────────────────────────────────
   STAGE TABS - Horizontal navigation tabs
   ───────────────────────────────────────────────────────────────────────────── */

.ct-stage-tabs {
    display: flex;
    gap: var(--ct-space-1);
    flex: 1 1 auto;
    min-width: fit-content; /* Don't shrink below content size */
}

.ct-stage-tab {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text-muted);
    background: transparent;
    border: 1px solid transparent;
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
    white-space: nowrap;
}

.ct-stage-tab:hover {
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
}

.ct-stage-tab--active {
    color: var(--ct-text);
    background: var(--ct-bg);
    border-color: var(--ct-accent);
    box-shadow: var(--ct-shadow-sm);
}

.ct-stage-tab__checkbox {
    width: 14px;
    height: 14px;
    margin: 0;
    flex-shrink: 0;
    accent-color: var(--ct-accent);
    cursor: pointer;
}

.ct-stage-tab__icon {
    font-size: 1em;
    flex-shrink: 0;
}

.ct-stage-tab__label {
    flex: 1 1 auto;
    min-width: max-content; /* Prevent label from shrinking to 0 */
}

.ct-stage-tab__status {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.25em;
    height: 1.25em;
    font-size: 0.75em;
    border-radius: 50%;
    flex-shrink: 0;
}

.ct-stage-tab--running .ct-stage-tab__status {
    color: var(--ct-accent);
}

.ct-stage-tab--complete .ct-stage-tab__status {
    color: var(--ct-success);
    background: var(--ct-success-bg);
}

.ct-stage-tab--error .ct-stage-tab__status {
    color: var(--ct-danger);
    background: var(--ct-danger-bg);
}

/* ─────────────────────────────────────────────────────────────────────────────
   PIPELINE CONTROLS - Run buttons and status
   ───────────────────────────────────────────────────────────────────────────── */

.ct-pipeline-controls {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-pipeline-controls--generating {
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-accent-muted);
    border-radius: var(--ct-radius);
}

.ct-pipeline-status {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    color: var(--ct-accent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   CHARACTER SELECTOR DROPDOWN
   ───────────────────────────────────────────────────────────────────────────── */

.ct-dropdown {
    position: relative;
    min-width: 200px;
    max-width: 280px;
}

.ct-dropdown__trigger {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    width: 100%;
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    color: var(--ct-text);
    background: var(--ct-bg);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
}

.ct-dropdown__trigger:hover {
    border-color: var(--ct-accent);
}

.ct-dropdown--open .ct-dropdown__trigger {
    border-color: var(--ct-accent);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}

.ct-dropdown__trigger-avatar {
    width: 24px;
    height: 24px;
    border-radius: var(--ct-radius-sm);
    object-fit: cover;
    flex-shrink: 0;
}

.ct-dropdown__trigger-icon {
    width: 24px;
    text-align: center;
    color: var(--ct-text-muted);
    flex-shrink: 0;
}

.ct-dropdown__trigger-text {
    flex: 1;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-dropdown__trigger-text--placeholder {
    color: var(--ct-text-muted);
}

.ct-dropdown__trigger-chevron {
    font-size: 0.75em;
    color: var(--ct-text-muted);
    transition: transform var(--ct-transition-fast);
    flex-shrink: 0;
}

.ct-dropdown--open .ct-dropdown__trigger-chevron {
    transform: rotate(180deg);
}

.ct-dropdown__panel {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    min-width: 320px;
    z-index: 1000; /* High z-index to stay above toolbar and other elements */
    display: none;
    flex-direction: column;
    /* Use solid chat background to prevent transparency bleed-through */
    background: var(--SmartThemeChatBg, #1a1a1a);
    /* Add backdrop blur for themes that still use transparency */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--ct-accent);
    border-top: none;
    border-bottom-left-radius: var(--ct-radius);
    border-bottom-right-radius: var(--ct-radius);
    box-shadow: var(--ct-shadow-lg);
    max-height: 400px;
    overflow: hidden;
}

.ct-dropdown--open .ct-dropdown__panel {
    display: flex;
}

.ct-dropdown__search {
    position: relative;
    padding: var(--ct-space-2);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-dropdown__search-icon {
    position: absolute;
    left: calc(var(--ct-space-2) + var(--ct-space-2));
    top: 50%;
    transform: translateY(-50%);
    color: var(--ct-text-muted);
    font-size: var(--ct-text-xs);
    pointer-events: none;
}

.ct-dropdown__search-input {
    width: 100%;
    padding: var(--ct-space-2) var(--ct-space-3);
    padding-left: calc(var(--ct-space-3) * 2 + 0.75em);
    font-size: var(--ct-text-sm);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
}

.ct-dropdown__search-input:focus {
    border-color: var(--ct-accent);
    outline: none;
}

.ct-dropdown__search-clear {
    position: absolute;
    right: calc(var(--ct-space-2) + var(--ct-space-1));
    top: 50%;
    transform: translateY(-50%);
    padding: var(--ct-space-1);
    background: none;
    border: none;
    color: var(--ct-text-muted);
    cursor: pointer;
    opacity: 0.7;
}

.ct-dropdown__search-clear:hover {
    opacity: 1;
    color: var(--ct-text);
}

.ct-dropdown__list {
    flex: 1;
    overflow-y: auto;
    max-height: 320px;
    padding: var(--ct-space-2);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-dropdown__empty {
    padding: var(--ct-space-6);
    text-align: center;
    font-size: var(--ct-text-sm);
    color: var(--ct-text-muted);
}

.ct-dropdown__empty i {
    display: block;
    font-size: 2em;
    margin-bottom: var(--ct-space-2);
    opacity: 0.5;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CHARACTER OPTION CARD - Pretty character list item
   ───────────────────────────────────────────────────────────────────────────── */

.ct-char-option {
    display: flex;
    align-items: flex-start;
    gap: var(--ct-space-3);
    padding: var(--ct-space-3);
    cursor: pointer;
    border-radius: var(--ct-radius);
    background: var(--ct-bg-secondary);
    border: 1px solid transparent;
    transition:
        background var(--ct-transition-fast),
        border-color var(--ct-transition-fast),
        box-shadow var(--ct-transition-fast),
        transform var(--ct-transition-fast);
}

.ct-char-option:hover {
    background: var(--ct-bg-tertiary);
    border-color: var(--ct-border);
    transform: translateX(2px);
}

.ct-char-option--selected {
    background: var(--ct-accent-muted);
    border-color: var(--ct-accent);
}

.ct-char-option--selected:hover {
    background: var(--ct-accent-muted);
}

.ct-char-option--highlighted {
    background: var(--ct-bg-tertiary);
    border-color: var(--ct-accent);
    box-shadow: 0 0 0 2px var(--ct-accent-muted);
}

/* Avatar wrapper with selection indicator */
.ct-char-option__avatar-wrap {
    position: relative;
    flex-shrink: 0;
}

.ct-char-option__avatar {
    width: 48px;
    height: 48px;
    border-radius: var(--ct-radius);
    object-fit: cover;
    border: 2px solid var(--ct-border-muted);
    transition: border-color var(--ct-transition-fast);
}

.ct-char-option:hover .ct-char-option__avatar {
    border-color: var(--ct-accent);
}

.ct-char-option--selected .ct-char-option__avatar {
    border-color: var(--ct-accent);
}

.ct-char-option__check {
    position: absolute;
    bottom: -4px;
    right: -4px;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--ct-accent);
    color: var(--ct-bg);
    border-radius: 50%;
    font-size: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Character info section */
.ct-char-option__info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.ct-char-option__name {
    font-size: var(--ct-text-sm);
    font-weight: 600;
    color: var(--ct-text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-char-option__desc {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.ct-char-option__meta {
    display: flex;
    align-items: center;
    gap: var(--ct-space-1);
    font-size: 10px;
    color: var(--ct-text-muted);
    margin-top: 2px;
}

.ct-char-option__meta i {
    font-size: 9px;
    opacity: 0.7;
}

/* ─────────────────────────────────────────────────────────────────────────────
   BODY - Two-panel layout (stacks on mobile)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-body {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0; /* Critical for nested flex overflow */
}

@media (min-width: 768px) {
    .ct-body {
        flex-direction: row;
    }
}

.ct-panel {
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

.ct-panel--left,
.ct-panel--config {
    flex: 1 1 auto;
    min-width: 0;
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-panel--right,
.ct-panel--results {
    flex: 1 1 auto;
    min-width: 0;
}

@media (min-width: 768px) {
    .ct-panel--left,
    .ct-panel--config {
        flex: 0 0 clamp(var(--ct-panel-min), 40%, var(--ct-panel-max));
        border-bottom: none;
        border-right: 1px solid var(--ct-border-muted);
    }

    .ct-panel--right,
    .ct-panel--results {
        flex: 1 1 60%;
    }
}

.ct-panel__content {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: var(--ct-space-3);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SECTION - Content grouping with optional header
   ───────────────────────────────────────────────────────────────────────────── */

.ct-section {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-3);
    padding: var(--ct-space-3);
    padding-top: 0; /* Header has its own padding */
    border-bottom: 1px solid var(--ct-border); /* Stronger border for visibility */
}

.ct-section:last-child {
    border-bottom: none;
}

.ct-section__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2);
    /* Make section headers stand out with background */
    margin: 0 calc(-1 * var(--ct-space-3));
    margin-bottom: 0;
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-tertiary);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-section__title {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    font-weight: 600;
    color: var(--ct-text);
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.ct-section__title i {
    color: var(--ct-accent);
    font-size: var(--ct-text-sm);
    width: 1.25em;
    text-align: center;
}

.ct-section__actions {
    display: flex;
    gap: var(--ct-space-1);
}

/* ─────────────────────────────────────────────────────────────────────────────
   CARD - Elevated content container
   ───────────────────────────────────────────────────────────────────────────── */

.ct-card {
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius);
    overflow: hidden;
}

.ct-card--interactive {
    cursor: pointer;
    transition:
        background var(--ct-transition-fast),
        border-color var(--ct-transition-fast);
}

.ct-card--interactive:hover {
    background: var(--ct-bg-tertiary);
    border-color: var(--ct-border);
}

.ct-card--selected {
    background: var(--ct-accent-muted);
    border-color: var(--ct-accent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   BUTTONS - Extend ST's .menu_button with modifiers
   ─────────────────────────────────────────────────────────────────────────────
   NOTE: Button modifiers (.menu_button--primary, --danger, --ghost, etc.)
   are now consolidated in the "BUTTON VARIANTS" section near the end of this
   file. This ensures consistent styling across all CT contexts (popup, settings
   modal, preset editor, drawer).
   ───────────────────────────────────────────────────────────────────────────── */

/* Success button (used sparingly, not in all contexts) */
.ct-popup .menu_button--success {
    background: var(--ct-success);
    border-color: var(--ct-success);
    color: white;
    filter: none;
}

/* Button groups */
.ct-button-group {
    display: flex;
    gap: var(--ct-space-2);
}

.ct-button-group--stretch .menu_button {
    flex: 1;
}

/* ─────────────────────────────────────────────────────────────────────────────
   FORM CONTROLS - Inputs, textareas, selects
   ───────────────────────────────────────────────────────────────────────────── */

/* Inherit ST's textarea/input styling, add consistent sizing */
.ct-popup input[type='text'],
.ct-popup input[type='number'],
.ct-popup input[type='search'],
.ct-popup textarea,
.ct-popup select {
    width: 100%;
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-family: var(--ct-font);
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius-sm);
    transition: border-color var(--ct-transition-fast);
}

.ct-popup input:focus,
.ct-popup textarea:focus,
.ct-popup select:focus {
    border-color: var(--ct-accent);
    outline: none;
}

.ct-popup textarea {
    min-height: 100px;
    resize: vertical;
    line-height: 1.5;
}

.ct-popup textarea.ct-textarea--code {
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
}

/* Search input with icon */
.ct-search {
    position: relative;
}

.ct-search__icon {
    position: absolute;
    left: var(--ct-space-3);
    top: 50%;
    transform: translateY(-50%);
    color: var(--ct-text-muted);
    pointer-events: none;
}

.ct-search__input {
    padding-left: calc(var(--ct-space-3) * 2 + 1em);
}

.ct-search__clear {
    position: absolute;
    right: var(--ct-space-1);
    top: 50%;
    transform: translateY(-50%);
    padding: var(--ct-space-1);
    background: none;
    border: none;
    color: var(--ct-text-muted);
    cursor: pointer;
    opacity: 0.7;
    transition: opacity var(--ct-transition-fast);
}

.ct-search__clear:hover {
    opacity: 1;
    color: var(--ct-text);
}

/* Checkbox/toggle rows */
.ct-checkbox {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    cursor: pointer;
    font-size: var(--ct-text-sm);
}

.ct-checkbox input[type='checkbox'] {
    width: auto;
    accent-color: var(--ct-accent);
}

/* Form group */
.ct-form-group {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-form-group__label {
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
}

.ct-form-group__hint {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

/* ─────────────────────────────────────────────────────────────────────────────
   TABS - Stage/mode selection
   ───────────────────────────────────────────────────────────────────────────── */

.ct-tabs {
    display: flex;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
    overflow-x: auto;
}

.ct-tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text-muted);
    background: transparent;
    border: 1px solid transparent;
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
    white-space: nowrap;
}

.ct-tab:hover {
    color: var(--ct-text);
    background: var(--ct-bg-tertiary);
}

.ct-tab--active {
    color: var(--ct-text);
    background: var(--ct-bg);
    border-color: var(--ct-accent);
    box-shadow: var(--ct-shadow-sm);
}

.ct-tab__icon {
    font-size: 1em;
}

.ct-tab__badge {
    font-size: var(--ct-text-xs);
    padding: 0.1em 0.5em;
    background: var(--ct-accent-muted);
    color: var(--ct-accent);
    border-radius: var(--ct-radius-pill);
}

/* Tab internal elements for pipeline tabs */
.ct-tab-checkbox {
    width: auto !important;
    margin: 0;
    accent-color: var(--ct-accent);
    cursor: pointer;
    flex-shrink: 0;
}

.ct-tab-icon {
    font-size: 1em;
    flex-shrink: 0;
}

.ct-tab-label {
    flex: 1;
    text-align: left;
}

.ct-tab-status {
    font-size: 0.75em;
    flex-shrink: 0;
    margin-left: auto;
}

/* Status indicator colors */
.ct-status--pending {
    color: var(--ct-text-dim);
}

.ct-status--running {
    color: var(--ct-accent);
}

.ct-status--complete {
    color: var(--ct-success);
}

.ct-status--error {
    color: var(--ct-danger);
}

/* ─────────────────────────────────────────────────────────────────────────────
   LIST ITEMS - Characters, presets, history
   ───────────────────────────────────────────────────────────────────────────── */

.ct-list {
    display: flex;
    flex-direction: column;
}

.ct-list-item {
    display: flex;
    align-items: flex-start;
    gap: var(--ct-space-3);
    padding: var(--ct-space-3);
    border-bottom: 1px solid var(--ct-border-muted);
    cursor: pointer;
    transition: background var(--ct-transition-fast);
}

.ct-list-item:last-child {
    border-bottom: none;
}

.ct-list-item:hover {
    background: var(--ct-bg-secondary);
}

.ct-list-item--selected {
    background: var(--ct-accent-muted);
    border-left: 3px solid var(--ct-accent);
}

.ct-list-item--highlighted {
    background: var(--ct-bg-tertiary);
    outline: 2px solid var(--ct-accent);
    outline-offset: -2px;
}

.ct-list-item__avatar {
    width: 48px;
    height: 48px;
    border-radius: var(--ct-radius-sm);
    object-fit: cover;
    flex-shrink: 0;
}

.ct-list-item__avatar--sm {
    width: 32px;
    height: 32px;
}

.ct-list-item__avatar--circle {
    border-radius: 50%;
}

.ct-list-item__content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-list-item__title {
    font-weight: 600;
    font-size: var(--ct-text-sm);
    color: var(--ct-text);
}

.ct-list-item__subtitle {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-muted);
}

.ct-list-item__meta {
    display: flex;
    gap: var(--ct-space-3);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-list-item__actions {
    display: flex;
    gap: var(--ct-space-1);
    opacity: 0;
    transition: opacity var(--ct-transition-fast);
}

.ct-list-item:hover .ct-list-item__actions {
    opacity: 1;
}

/* Empty state */
.ct-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--ct-space-8);
    text-align: center;
    color: var(--ct-text-muted);
}

.ct-empty__icon {
    font-size: 3rem;
    opacity: 0.3;
    margin-bottom: var(--ct-space-4);
}

.ct-empty__title {
    font-weight: 500;
    margin-bottom: var(--ct-space-2);
}

.ct-empty__text {
    font-size: var(--ct-text-sm);
    color: var(--ct-text-dim);
}

/* ─────────────────────────────────────────────────────────────────────────────
   FIELD CHECKBOXES - Multi-select field list
   ───────────────────────────────────────────────────────────────────────────── */

.ct-field-list {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
    max-height: 200px;
    overflow-y: auto;
    padding: var(--ct-space-2);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius);
}

.ct-field-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-3); /* Increase gap between elements */
    padding: var(--ct-space-2) var(--ct-space-2);
    border-radius: var(--ct-radius-sm);
    transition: background var(--ct-transition-fast);
}

.ct-field-item:hover {
    background: var(--ct-bg-tertiary);
}

.ct-field-item__label {
    display: flex;
    align-items: center;
    gap: var(--ct-space-3); /* Increase gap for better readability */
    flex: 1;
    min-width: 0; /* Allow text truncation */
    cursor: pointer;
    font-size: var(--ct-text-sm);
}

.ct-field-item__meta {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

/* Field item internal elements */
.ct-field-label {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    flex: 1;
    cursor: pointer;
    font-size: var(--ct-text-sm);
}

.ct-field-checkbox {
    width: auto !important;
    margin: 0;
    accent-color: var(--ct-accent);
    cursor: pointer;
    flex-shrink: 0;
}

.ct-field-name {
    flex: 1;
    color: var(--ct-text);
}

.ct-field-tokens,
.ct-field-count {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
    flex-shrink: 0;
    min-width: 2.5em;
    text-align: right;
}

/* Expandable field groups (for alternate greetings) */
.ct-field-group {
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
    overflow: hidden;
}

.ct-field-group .ct-field-item--parent {
    background: var(--ct-bg-tertiary);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-field-group .ct-field-children {
    display: none;
    padding: var(--ct-space-1);
    background: var(--ct-bg-secondary);
}

.ct-field-group--expanded .ct-field-children {
    display: block;
}

.ct-field-group .ct-field-item--child {
    padding-left: var(--ct-space-4);
}

.ct-field-expand {
    padding: var(--ct-space-1);
    background: none;
    border: none;
    color: var(--ct-text-muted);
    cursor: pointer;
    transition: transform var(--ct-transition-fast);
}

.ct-field-expand:hover {
    color: var(--ct-text);
}

.ct-field-group--expanded .ct-field-expand {
    transform: rotate(180deg);
}

/* Field preview (collapsible content preview) */
.ct-field-preview {
    display: none;
    flex-direction: column;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: var(--ct-bg-secondary);
    border-top: 1px solid var(--ct-border-muted);
}

.ct-field-group--expanded .ct-field-preview {
    display: flex;
}

.ct-field-preview__text {
    position: relative;
    margin: 0;
    padding: var(--ct-space-2);
    max-height: 100px;
    overflow: hidden;
    font-size: var(--ct-text-xs);
    font-family: var(--ct-font-mono);
    white-space: pre-wrap;
    word-break: break-word;
    line-height: 1.4;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    color: var(--ct-text-muted);
}

/* Fade out effect at bottom when content is truncated */
.ct-field-preview__text::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(transparent, var(--ct-bg-tertiary));
    pointer-events: none;
}

.ct-field-preview__more {
    display: inline-flex;
    align-items: center;
    align-self: flex-start;
    gap: var(--ct-space-1);
    padding: var(--ct-space-1) var(--ct-space-2);
    font-size: var(--ct-text-xs);
    color: var(--ct-accent);
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-accent-muted);
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
    flex-shrink: 0;
}

.ct-field-preview__more:hover {
    background: var(--ct-accent-muted);
}

.ct-field-preview-btn {
    padding: var(--ct-space-1);
    background: none;
    border: none;
    color: var(--ct-text-dim);
    cursor: pointer;
    transition: color var(--ct-transition-fast);
}

.ct-field-preview-btn:hover {
    color: var(--ct-accent);
}

/* Popup preview styles */
.ct-popup-preview {
    margin: 0;
    padding: var(--ct-space-3);
    max-height: 60vh;
    overflow-y: auto;
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-sm);
    white-space: pre-wrap;
    word-break: break-word;
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
}

/* Select dropdown styling */
.ct-select {
    width: auto;
    min-width: 120px;
    padding: var(--ct-space-1) var(--ct-space-2);
    font-size: var(--ct-text-xs);
    font-family: var(--ct-font);
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: border-color var(--ct-transition-fast);
}

.ct-select:hover {
    border-color: var(--ct-accent);
}

.ct-select:focus {
    border-color: var(--ct-accent);
    outline: none;
}

/* ─────────────────────────────────────────────────────────────────────────────
   RESULTS/OUTPUT PANEL
   ───────────────────────────────────────────────────────────────────────────── */

/* Results wrapper - flex container that manages layout */
.ct-results-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
    overflow: hidden;
}

/* Toolbar with view toggle */
.ct-results-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
}

/* Scrollable content area */
.ct-results-content {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
}

.ct-result {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.ct-result__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
}

.ct-result__type {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-muted);
}

.ct-result__actions {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

/* JSON display mode toggle (smart/raw) */
.ct-json-toggle {
    display: flex;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    padding: 2px;
}

.ct-json-toggle__btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 24px;
    border: none;
    background: transparent;
    color: var(--ct-text-dim);
    cursor: pointer;
    border-radius: var(--ct-radius-sm);
    transition: all var(--ct-transition-fast);
}

.ct-json-toggle__btn:hover {
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
}

.ct-json-toggle__btn--active {
    color: var(--ct-accent);
    background: var(--ct-bg);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Text toggle (shares JSON toggle styling) */
.ct-text-toggle {
    display: flex;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    padding: 2px;
}

.ct-text-toggle__btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 24px;
    border: none;
    background: transparent;
    color: var(--ct-text-dim);
    cursor: pointer;
    border-radius: var(--ct-radius-sm);
    transition: all var(--ct-transition-fast);
}

.ct-text-toggle__btn:hover {
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
}

.ct-text-toggle__btn--active {
    color: var(--ct-accent);
    background: var(--ct-bg);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Raw text output */
.ct-result__raw {
    margin: 0;
    padding: var(--ct-space-3);
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius);
    color: var(--ct-text);
    user-select: text;
}

.ct-result__content {
    flex: 1;
    overflow-y: auto;
    padding: var(--ct-space-3);
}

.ct-result__json {
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
    padding: var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
}

.ct-result__prose {
    line-height: 1.7;
}

/* Code output with syntax highlighting */
.ct-result__code {
    margin: 0;
    padding: var(--ct-space-3);
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.5;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius);
    overflow-x: auto;
}

.ct-result__code code {
    font-family: inherit;
}

/* Prose styling - minimal overrides, let showdown do its thing */
.ct-result__prose {
    font-size: var(--ct-text-sm);
    line-height: 1.7;
}

.ct-result__prose h1,
.ct-result__prose h2,
.ct-result__prose h3 {
    font-weight: 600;
    margin-top: 1.25em;
    margin-bottom: 0.5em;
}

.ct-result__prose h1:first-child,
.ct-result__prose h2:first-child,
.ct-result__prose h3:first-child {
    margin-top: 0;
}

.ct-result__prose p {
    margin: 0 0 0.75em 0;
}

.ct-result__prose ul,
.ct-result__prose ol {
    margin: 0.5em 0;
    padding-left: 1.5em;
}

.ct-result__prose li {
    margin: 0.25em 0;
}

.ct-result__prose code {
    font-family: var(--ct-font-mono);
    font-size: 0.9em;
    padding: 0.15em 0.4em;
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius-sm);
}

.ct-result__prose pre {
    margin: 0.75em 0;
    padding: var(--ct-space-2);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
    overflow-x: auto;
}

.ct-result__prose pre code {
    padding: 0;
    background: none;
}

.ct-result__prose strong {
    font-weight: 600;
}

/* Alert message styling */
.ct-alert__message {
    margin-top: var(--ct-space-1);
    font-size: var(--ct-text-sm);
    white-space: pre-wrap;
}

/* ─────────────────────────────────────────────────────────────────────────────
   COMPARE VIEW
   ───────────────────────────────────────────────────────────────────────────── */

.ct-compare-view {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
}

.ct-compare-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-2) var(--ct-space-3);
    border-bottom: 1px solid var(--ct-border);
    flex-shrink: 0;
}

.ct-compare-stats {
    display: flex;
    gap: var(--ct-space-2);
}

.ct-compare-list {
    flex: 1;
    overflow-y: auto;
    padding: var(--ct-space-2);
}

.ct-compare-row {
    margin-bottom: var(--ct-space-3);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius);
    overflow: hidden;
}

.ct-compare-row--changed {
    border-color: var(--ct-accent);
}

.ct-compare-row--unchanged {
    opacity: 0.7;
}

.ct-compare-row__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border);
}

.ct-compare-row__label {
    font-weight: 600;
    font-size: var(--ct-text-sm);
}

.ct-compare-row__content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--ct-border);
}

.ct-compare-row__content--single {
    grid-template-columns: 1fr;
    background: transparent;
}

.ct-compare-col {
    background: var(--ct-bg);
    padding: var(--ct-space-2);
}

.ct-compare-col__header {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-xs);
    font-weight: 600;
    text-transform: uppercase;
    color: var(--ct-text-dim);
    margin-bottom: var(--ct-space-2);
}

.ct-compare-col--original .ct-compare-col__header {
    color: var(--ct-danger);
}

.ct-compare-col--rewritten .ct-compare-col__header {
    color: var(--ct-success);
}

.ct-compare-text {
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
    margin: 0;
    max-height: 200px;
    overflow-y: auto;
}

.ct-diff--added {
    background: rgba(var(--ct-success-rgb, 46, 160, 67), 0.2);
    color: var(--ct-success);
    padding: 0 2px;
    border-radius: 2px;
}

.ct-diff--removed {
    background: rgba(var(--ct-danger-rgb, 248, 81, 73), 0.2);
    color: var(--ct-danger);
    text-decoration: line-through;
    opacity: 0.8;
    padding: 0 2px;
    border-radius: 2px;
}

/* Diff stats (GitHub-style +/- display) */
.ct-diff-stats {
    display: inline-flex;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-xs);
    font-family: var(--ct-font-mono);
    font-weight: 600;
}

.ct-diff-stats__add {
    color: var(--ct-success);
}

.ct-diff-stats__del {
    color: var(--ct-danger);
}

.ct-compare-row__badges {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-compare-popup {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--ct-space-4);
}

.ct-compare-popup__side h4 {
    margin-bottom: var(--ct-space-2);
    font-weight: 600;
}

.ct-compare-popup__side pre {
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 400px;
    overflow-y: auto;
    padding: var(--ct-space-2);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
}

/* View mode toggle */
.ct-view-toggle {
    display: flex;
    gap: var(--ct-space-1);
    background: var(--ct-bg-secondary);
    padding: var(--ct-space-1);
    border-radius: var(--ct-radius);
}

.ct-view-toggle__btn {
    padding: var(--ct-space-1) var(--ct-space-2);
    font-size: var(--ct-text-xs);
    border-radius: calc(var(--ct-radius) - 2px);
    background: transparent;
    border: none;
    color: var(--ct-text-dim);
    cursor: pointer;
    transition: all 0.15s ease;
}

.ct-view-toggle__btn:hover {
    color: var(--ct-text);
}

.ct-view-toggle__btn--active {
    background: var(--ct-bg);
    color: var(--ct-text);
    box-shadow: var(--ct-shadow-sm);
}

/* ─────────────────────────────────────────────────────────────────────────────
   ALERTS & MESSAGES
   ───────────────────────────────────────────────────────────────────────────── */

.ct-alert {
    display: flex;
    gap: var(--ct-space-3);
    padding: var(--ct-space-3);
    border-radius: var(--ct-radius);
    font-size: var(--ct-text-sm);
}

.ct-alert--info {
    background: var(--ct-accent-muted);
    border: 1px solid var(--ct-accent);
    color: var(--ct-accent);
}

.ct-alert--success {
    background: var(--ct-success-bg);
    border: 1px solid var(--ct-success);
    color: var(--ct-success);
}

.ct-alert--warning {
    background: var(--ct-warning-bg);
    border: 1px solid var(--ct-warning);
    color: var(--ct-warning);
}

.ct-alert--danger {
    background: var(--ct-danger-bg);
    border: 1px solid var(--ct-danger);
    color: var(--ct-danger);
}

.ct-alert__icon {
    flex-shrink: 0;
}

.ct-alert__content {
    flex: 1;
}

.ct-alert__title {
    font-weight: 600;
    margin-bottom: var(--ct-space-1);
}

/* ─────────────────────────────────────────────────────────────────────────────
   GENERATING/LOADING INDICATOR
   ───────────────────────────────────────────────────────────────────────────── */

.ct-loading {
    display: flex;
    align-items: center;
    gap: var(--ct-space-3);
    padding: var(--ct-space-3);
    background: var(--ct-accent-muted);
    border-radius: var(--ct-radius);
    color: var(--ct-accent);
    font-size: var(--ct-text-sm);
    animation: ct-pulse 2s ease-in-out infinite;
}

.ct-loading__spinner {
    animation: ct-spin 1s linear infinite;
}

@keyframes ct-spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes ct-pulse {
    0%,
    100% {
        opacity: 1;
    }
    50% {
        opacity: 0.6;
    }
}

/* ─────────────────────────────────────────────────────────────────────────────
   BADGES
   ───────────────────────────────────────────────────────────────────────────── */

.ct-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.2em 0.6em;
    font-size: var(--ct-text-xs);
    font-weight: 500;
    border-radius: var(--ct-radius-pill);
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.ct-badge--default {
    background: var(--ct-bg-tertiary);
    color: var(--ct-text-muted);
}

.ct-badge--accent {
    background: var(--ct-accent-muted);
    color: var(--ct-accent);
}

.ct-badge--success {
    background: var(--ct-success-bg);
    color: var(--ct-success);
}

.ct-badge--warning {
    background: var(--ct-warning-bg);
    color: var(--ct-warning);
}

.ct-badge--danger {
    background: var(--ct-danger-bg);
    color: var(--ct-danger);
}

/* ─────────────────────────────────────────────────────────────────────────────
   HISTORY PANEL (Collapsible)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-history {
    flex-shrink: 0;
    border-top: 1px solid var(--ct-border-muted);
    background: var(--ct-bg);
}

.ct-history__toggle {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    width: 100%;
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border: none;
    cursor: pointer;
    font-size: var(--ct-text-xs);
    font-weight: 500;
    color: var(--ct-text-muted);
    text-align: left;
}

.ct-history__toggle:hover {
    background: var(--ct-bg-tertiary);
    color: var(--ct-text);
}

.ct-history__toggle-icon {
    margin-left: auto;
    transition: transform var(--ct-transition-fast);
}

.ct-history--collapsed .ct-history__toggle-icon {
    transform: rotate(-90deg);
}

.ct-history--collapsed .ct-history__list {
    display: none;
}

.ct-history__list {
    max-height: 180px;
    overflow-y: auto;
    padding: var(--ct-space-1);
    background: var(--ct-bg-secondary);
}

/* List item error state (for history) */
.ct-list-item--error {
    border-left: 3px solid var(--ct-danger);
}

.ct-list-item--error .ct-list-item__title {
    color: var(--ct-danger);
}

/* ─────────────────────────────────────────────────────────────────────────────
   PRESET MANAGER - Unified preset management section
   ───────────────────────────────────────────────────────────────────────────── */

.ct-presets-manager {
    margin-top: var(--ct-space-3);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius);
    background: var(--ct-bg-secondary);
    overflow: hidden;
}

.ct-presets-manager__toggle {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    width: 100%;
    padding: var(--ct-space-3);
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: var(--ct-text-sm);
    font-weight: 600;
    color: var(--ct-text);
    text-align: left;
    transition: background var(--ct-transition-fast);
}

.ct-presets-manager__toggle:hover {
    background: var(--ct-bg-tertiary);
}

.ct-presets-manager__title {
    flex: 1;
}

.ct-presets-manager__count {
    padding: 0.125em 0.5em;
    font-size: var(--ct-text-xs);
    font-weight: 500;
    background: var(--ct-accent-muted);
    color: var(--ct-accent);
    border-radius: var(--ct-radius-pill);
}

.ct-presets-manager__chevron {
    color: var(--ct-text-muted);
    transition: transform var(--ct-transition-fast);
}

.ct-presets-manager--collapsed .ct-presets-manager__chevron {
    transform: rotate(-90deg);
}

.ct-presets-manager--collapsed .ct-presets-manager__content {
    display: none;
}

.ct-presets-manager__content {
    border-top: 1px solid var(--ct-border-muted);
}

.ct-presets-manager__tabs {
    display: flex;
    background: var(--ct-bg-tertiary);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-presets-manager__tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-size: var(--ct-text-xs);
    font-weight: 500;
    color: var(--ct-text-muted);
    transition: all var(--ct-transition-fast);
}

.ct-presets-manager__tab:hover {
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
}

.ct-presets-manager__tab--active {
    color: var(--ct-accent);
    border-bottom-color: var(--ct-accent);
    background: var(--ct-bg-secondary);
}

.ct-presets-manager__tab .ct-badge {
    background: var(--ct-bg-tertiary);
    color: var(--ct-text-muted);
}

.ct-presets-manager__tab--active .ct-badge {
    background: var(--ct-accent-muted);
    color: var(--ct-accent);
}

.ct-presets-manager__list {
    max-height: 200px;
    overflow-y: auto;
    padding: var(--ct-space-2);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-preset-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-4);
    color: var(--ct-text-muted);
    font-size: var(--ct-text-sm);
}

.ct-preset-empty i {
    font-size: 1.5em;
    opacity: 0.5;
}

.ct-preset-item {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: var(--ct-bg);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
    transition: all var(--ct-transition-fast);
}

.ct-preset-item:hover {
    border-color: var(--ct-border);
}

.ct-preset-item--builtin {
    opacity: 0.85;
}

.ct-preset-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.ct-preset-name {
    display: flex;
    align-items: center;
    gap: var(--ct-space-1);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-preset-name i {
    font-size: 0.75em;
}

.ct-preset-stages {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-preset-actions {
    display: flex;
    gap: 2px;
    flex-shrink: 0;
    opacity: 0.6;
    transition: opacity var(--ct-transition-fast);
}

.ct-preset-item:hover .ct-preset-actions {
    opacity: 1;
}

.ct-preset-action {
    padding: var(--ct-space-1) !important;
    min-width: 0 !important;
}

.ct-presets-manager__actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-top: 1px solid var(--ct-border-muted);
}

.ct-presets-manager__io {
    display: flex;
    gap: var(--ct-space-1);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SESSIONS PANEL (Collapsible)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-sessions {
    margin-top: var(--ct-space-4);
    border-top: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
}

.ct-sessions__toggle {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    width: 100%;
    padding: var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border: none;
    border-left: 2px solid transparent;
    cursor: pointer;
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
    text-align: left;
    transition: all var(--ct-transition-fast);
}

.ct-sessions__toggle::before {
    content: '\f07c'; /* folder-open icon */
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    color: var(--ct-text-muted);
    transition: color var(--ct-transition-fast);
}

.ct-sessions__toggle:hover {
    background: var(--ct-bg-tertiary);
    border-left-color: var(--ct-accent);
}

.ct-sessions__toggle:hover::before {
    color: var(--ct-accent);
}

.ct-sessions__toggle-icon {
    margin-left: auto;
    color: var(--ct-text-muted);
    transition:
        transform var(--ct-transition-fast),
        color var(--ct-transition-fast);
}

.ct-sessions__toggle:hover .ct-sessions__toggle-icon {
    color: var(--ct-text);
}

.ct-sessions--hidden {
    display: none;
}

.ct-sessions--collapsed .ct-sessions__toggle-icon {
    transform: rotate(-90deg);
}

.ct-sessions--collapsed .ct-sessions__content {
    display: none;
}

.ct-sessions__content {
    padding: var(--ct-space-2);
    background: var(--ct-bg);
}

.ct-sessions__actions {
    display: flex;
    gap: var(--ct-space-2);
    margin-bottom: var(--ct-space-2);
}

.ct-sessions__list {
    max-height: 200px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

/* Session Item */
.ct-session-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
}

.ct-session-item:hover {
    border-color: var(--ct-border);
    background: var(--ct-bg-tertiary);
}

.ct-session-item--active {
    border-color: var(--ct-accent);
    background: var(--ct-accent-muted);
}

.ct-session-item__content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-session-item__header {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-session-item__date {
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
}

.ct-session-item__meta {
    display: flex;
    gap: var(--ct-space-3);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-session-item__meta span {
    display: flex;
    align-items: center;
    gap: var(--ct-space-1);
}

.ct-session-item__actions {
    display: flex;
    gap: var(--ct-space-1);
    opacity: 0;
    transition: opacity var(--ct-transition-fast);
}

.ct-session-item:hover .ct-session-item__actions {
    opacity: 1;
}

.ct-session-item--active .ct-session-item__actions {
    opacity: 1;
}

/* ─────────────────────────────────────────────────────────────────────────────
   PREVIEW & ERROR CONTENT (for popups)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-preview-content {
    max-height: 60vh;
    overflow-y: auto;
    padding: var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
}

.ct-preview-content pre {
    margin: 0;
    padding: 0;
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-word;
}

.ct-error-box {
    padding: var(--ct-space-3);
    background: var(--ct-danger-bg);
    border: 1px solid var(--ct-danger);
    border-radius: var(--ct-radius);
    color: var(--ct-danger);
    font-size: var(--ct-text-sm);
}

/* ─────────────────────────────────────────────────────────────────────────────
   STAGE CONFIG COMPONENT
   ───────────────────────────────────────────────────────────────────────────── */

.ct-stage-config {
    /* Inherits from ct-section */
}

.ct-stage-config .ct-form-group textarea {
    min-height: 120px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Two-column layout
   ───────────────────────────────────────────────────────────────────────────── */

/* Override ST popup sizing for settings modal */
.popup:has(.ct-settings-modal) {
    width: 90dvw;
    max-width: 900px;
    min-width: 320px;
    padding: 0;
}

@media (min-width: 1024px) {
    .popup:has(.ct-settings-modal) {
        max-width: 1000px;
    }
}

/* Container for settings modal content */
.ct-settings-modal {
    display: flex;
    flex-direction: column;
    max-height: 80vh;
    color: var(--ct-text);
    font-family: var(--ct-font);
    font-size: var(--ct-font-size);
}

.ct-settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-settings-header h2 {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    margin: 0;
    font-size: var(--ct-text-lg);
    font-weight: 600;
}

.ct-settings-header h2 i {
    color: var(--ct-accent);
}

.ct-settings-body {
    flex: 1;
    overflow-y: auto;
    padding: var(--ct-space-4);
    scrollbar-width: thin;
    scrollbar-color: var(--ct-border) transparent;
}

.ct-settings-columns {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--ct-space-4);
}

/* Two-column layout requires more space to prevent truncation */
@media (min-width: 850px) {
    .ct-settings-columns {
        grid-template-columns: 1fr 1fr;
    }
}

/* Give left column (Generation settings) more space at wide viewports */
@media (min-width: 1000px) {
    .ct-settings-columns {
        grid-template-columns: 1.2fr 1fr;
    }
}

.ct-settings-column {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-4);
}

.ct-settings-section {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-3);
    padding: var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius);
}

.ct-settings-section h3 {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    margin: 0 0 var(--ct-space-2) 0;
    padding-bottom: var(--ct-space-2);
    border-bottom: 1px solid var(--ct-border-muted);
    font-size: var(--ct-text-base);
    font-weight: 600;
}

.ct-settings-section h3 i {
    color: var(--ct-accent);
    font-size: var(--ct-text-sm);
}

.ct-settings-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-3) var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border-top: 1px solid var(--ct-border-muted);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - API Status Banner
   ───────────────────────────────────────────────────────────────────────────── */

.ct-api-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-3);
    padding: var(--ct-space-2) var(--ct-space-3);
    border-radius: var(--ct-radius);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    margin-bottom: var(--ct-space-3);
}

.ct-api-banner--ready {
    border-color: var(--ct-success);
    background: color-mix(
        in srgb,
        var(--ct-success) 10%,
        var(--ct-bg-secondary)
    );
}

.ct-api-banner--error {
    border-color: var(--ct-error);
    background: color-mix(in srgb, var(--ct-error) 10%, var(--ct-bg-secondary));
}

.ct-api-banner__left {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-api-banner--ready .ct-api-banner__left i {
    color: var(--ct-success);
}

.ct-api-banner--error .ct-api-banner__left i {
    color: var(--ct-error);
}

.ct-api-banner__name {
    font-weight: 500;
    font-size: var(--ct-text-sm);
}

.ct-api-banner__right {
    display: flex;
    align-items: center;
    gap: var(--ct-space-3);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-muted);
}

.ct-api-banner__model {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-api-error {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    margin-bottom: var(--ct-space-3);
    font-size: var(--ct-text-xs);
    color: var(--ct-error);
    background: color-mix(in srgb, var(--ct-error) 8%, transparent);
    border-radius: var(--ct-radius);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Generation Mode Toggle
   ───────────────────────────────────────────────────────────────────────────── */

.ct-gen-mode-toggle {
    display: flex;
    gap: var(--ct-space-2);
    margin-bottom: var(--ct-space-3);
}

.ct-gen-mode-option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius);
    background: var(--ct-bg-secondary);
    cursor: pointer;
    transition: all var(--ct-transition);
    font-size: var(--ct-text-sm);
}

.ct-gen-mode-option input[type='radio'] {
    display: none;
}

.ct-gen-mode-option:hover {
    border-color: var(--ct-border);
    background: var(--ct-bg-hover);
}

.ct-gen-mode-option--active {
    border-color: var(--ct-accent);
    background: color-mix(
        in srgb,
        var(--ct-accent) 15%,
        var(--ct-bg-secondary)
    );
}

.ct-gen-mode-option--active i {
    color: var(--ct-accent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Profile Selection
   ───────────────────────────────────────────────────────────────────────────── */

.ct-profile-section {
    padding: var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius);
    border: 1px solid var(--ct-border-muted);
}

.ct-profile-info {
    margin-top: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: var(--ct-bg);
    border-radius: var(--ct-radius-sm);
}

.ct-profile-info--empty {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    color: var(--ct-text-dim);
    font-size: var(--ct-text-sm);
    font-style: italic;
}

.ct-profile-info--error {
    border: 1px solid var(--ct-error);
}

.ct-profile-info__row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-1) 0;
    font-size: var(--ct-text-xs);
}

.ct-profile-info__row:not(:last-child) {
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-profile-info__label {
    color: var(--ct-text-muted);
}

.ct-profile-info__value {
    font-weight: 500;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-profile-info__error {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    margin-top: var(--ct-space-2);
    padding: var(--ct-space-2);
    font-size: var(--ct-text-xs);
    color: var(--ct-error);
    background: color-mix(in srgb, var(--ct-error) 10%, transparent);
    border-radius: var(--ct-radius-sm);
}

.ct-profile-empty {
    display: flex;
    gap: var(--ct-space-2);
    padding: var(--ct-space-3);
    color: var(--ct-text-muted);
    font-size: var(--ct-text-sm);
}

.ct-profile-empty i {
    color: var(--ct-accent);
    flex-shrink: 0;
    margin-top: 2px;
}

.ct-profile-empty strong {
    display: block;
    margin-bottom: var(--ct-space-1);
    color: var(--ct-text);
}

.ct-profile-empty p {
    margin: 0;
    font-size: var(--ct-text-xs);
    line-height: 1.4;
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Form Elements
   ───────────────────────────────────────────────────────────────────────────── */

.ct-setting-item {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-setting-label {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
    cursor: pointer;
}

.ct-setting-label input[type='checkbox'] {
    width: auto;
    accent-color: var(--ct-accent);
    cursor: pointer;
}

.ct-setting-hint {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-setting-desc {
    margin: 0 0 var(--ct-space-2) 0;
    font-size: var(--ct-text-sm);
    color: var(--ct-text-muted);
    line-height: 1.5;
}

.ct-number-input {
    width: 120px !important;
    padding: var(--ct-space-2);
    font-size: var(--ct-text-sm);
}

.ct-textarea {
    width: 100%;
    min-height: 100px;
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-family: var(--ct-font);
    line-height: 1.5;
    resize: vertical;
}

.ct-readonly-text {
    margin: 0;
    padding: var(--ct-space-3);
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-word;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    max-height: 150px;
    overflow-y: auto;
}

.ct-version {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Preset Tabs & Lists
   ───────────────────────────────────────────────────────────────────────────── */

.ct-presets-tabs {
    display: flex;
    gap: var(--ct-space-1);
    padding: var(--ct-space-1);
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    margin-bottom: var(--ct-space-3);
}

.ct-presets-tab {
    flex: 1;
    padding: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text-muted);
    background: transparent;
    border: none;
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
}

.ct-presets-tab:hover {
    color: var(--ct-text);
    background: var(--ct-bg-secondary);
}

.ct-presets-tab--active {
    color: var(--ct-text);
    background: var(--ct-bg);
    box-shadow: var(--ct-shadow-sm);
}

.ct-presets-list {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
    max-height: 250px;
    overflow-y: auto;
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
    margin-bottom: var(--ct-space-3);
}

.ct-preset-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
    transition: all var(--ct-transition-fast);
}

.ct-preset-item:hover {
    border-color: var(--ct-border);
    background: var(--ct-bg);
}

.ct-preset-item--builtin {
    opacity: 0.8;
}

.ct-preset-info {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
    min-width: 0;
    flex: 1;
}

.ct-preset-name {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ct-preset-stages {
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-preset-actions {
    display: flex;
    gap: var(--ct-space-1);
    flex-shrink: 0;
}

.ct-presets-actions {
    display: flex;
    gap: var(--ct-space-2);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Shortcuts List
   ───────────────────────────────────────────────────────────────────────────── */

.ct-shortcuts-list {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-shortcuts-list .ct-shortcut {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
}

.ct-shortcuts-list .ct-shortcut kbd {
    display: inline-flex;
    align-items: center;
    padding: 0.2em 0.5em;
    font-family: var(--ct-font);
    font-size: var(--ct-text-xs);
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius-sm);
}

.ct-shortcuts-list .ct-shortcut span {
    color: var(--ct-text-muted);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SETTINGS MODAL - Debug Actions
   ───────────────────────────────────────────────────────────────────────────── */

.ct-debug-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--ct-space-2);
    margin-top: var(--ct-space-2);
}

/* ─────────────────────────────────────────────────────────────────────────────
   FORM ELEMENTS (shared by settings modal, preset drawer)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-label {
    display: block;
    margin-bottom: var(--ct-space-1);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    color: var(--ct-text);
}

.ct-required {
    color: var(--ct-danger);
}

.ct-input {
    width: 100%;
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-family: var(--ct-font);
}

.ct-hint {
    display: block;
    margin-top: var(--ct-space-1);
    font-size: var(--ct-text-xs);
    color: var(--ct-text-dim);
}

.ct-checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: var(--ct-space-3);
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
}

.ct-checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    color: var(--ct-text);
    cursor: pointer;
}

.ct-checkbox-label input[type='checkbox'] {
    width: auto;
    accent-color: var(--ct-accent);
    cursor: pointer;
}

.ct-textarea--code {
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    tab-size: 2;
}

.ct-textarea--compact {
    min-height: 60px;
    padding: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    line-height: 1.4;
    resize: vertical;
}

.ct-schema-toolbar {
    display: flex;
    gap: var(--ct-space-2);
    margin-bottom: var(--ct-space-2);
}

/* ─────────────────────────────────────────────────────────────────────────────
   PRESET EDITOR - Validation Messages
   ───────────────────────────────────────────────────────────────────────────── */

.ct-errors,
.ct-warnings {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
    padding: var(--ct-space-3);
    border-radius: var(--ct-radius-sm);
}

.ct-errors {
    background: var(--ct-danger-bg);
    border: 1px solid var(--ct-danger);
}

.ct-warnings {
    background: var(--ct-warning-bg);
    border: 1px solid var(--ct-warning);
}

.ct-error {
    font-size: var(--ct-text-sm);
    color: var(--ct-danger);
}

.ct-warning {
    font-size: var(--ct-text-sm);
    color: var(--ct-warning);
}

/* ─────────────────────────────────────────────────────────────────────────────
   BUTTON VARIANTS - Consolidated modifiers for all CT contexts
   ─────────────────────────────────────────────────────────────────────────────
   These extend ST's .menu_button with consistent modifiers. Use the consolidated
   selector pattern to apply to all CT contexts (popup, settings, drawer, etc.)
   ───────────────────────────────────────────────────────────────────────────── */

/* Base menu_button normalization for ALL CT contexts */
.ct-popup .menu_button,
.ct-settings-modal .menu_button,
.ct-drawer .menu_button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--ct-space-1);
    padding: var(--ct-space-2) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    font-weight: 500;
    white-space: nowrap;
    border-radius: var(--ct-radius-sm);
    transition: all var(--ct-transition-fast);
    width: auto;
    min-width: auto;
    margin: 0;
}

/* Icon-only button (square) */
.ct-popup .menu_button--icon,
.ct-settings-modal .menu_button--icon,
.ct-drawer .menu_button--icon {
    padding: var(--ct-space-2);
    aspect-ratio: 1;
}

/* Small button */
.ct-popup .menu_button--sm,
.ct-settings-modal .menu_button--sm,
.ct-drawer .menu_button--sm {
    padding: var(--ct-space-1) var(--ct-space-2);
    font-size: var(--ct-text-xs);
}

/* Large button */
.ct-popup .menu_button--lg,
.ct-settings-modal .menu_button--lg,
.ct-drawer .menu_button--lg {
    padding: var(--ct-space-3) var(--ct-space-4);
    font-size: var(--ct-text-base);
}

/* Full width button */
.ct-popup .menu_button--full,
.ct-settings-modal .menu_button--full,
.ct-drawer .menu_button--full {
    width: 100%;
}

/* Primary (accent) button */
.ct-popup .menu_button--primary,
.ct-settings-modal .menu_button--primary,
.ct-drawer .menu_button--primary {
    background: var(--ct-accent);
    border-color: var(--ct-accent);
    color: var(--ct-bg);
    filter: none;
}

.ct-popup .menu_button--primary:hover:not(:disabled),
.ct-settings-modal .menu_button--primary:hover:not(:disabled),
.ct-drawer .menu_button--primary:hover:not(:disabled) {
    background: var(--ct-accent-hover);
    border-color: var(--ct-accent-hover);
    filter: none;
}

/* Danger button */
.ct-popup .menu_button--danger,
.ct-settings-modal .menu_button--danger,
.ct-drawer .menu_button--danger {
    background: var(--ct-danger);
    border-color: var(--ct-danger);
    color: white;
    filter: none;
}

.ct-popup .menu_button--danger:hover:not(:disabled),
.ct-settings-modal .menu_button--danger:hover:not(:disabled),
.ct-drawer .menu_button--danger:hover:not(:disabled) {
    filter: brightness(1.1);
}

/* Ghost button (transparent background) */
.ct-popup .menu_button--ghost,
.ct-settings-modal .menu_button--ghost,
.ct-drawer .menu_button--ghost {
    background: transparent;
    border-color: transparent;
}

.ct-popup .menu_button--ghost:hover:not(:disabled),
.ct-settings-modal .menu_button--ghost:hover:not(:disabled),
.ct-drawer .menu_button--ghost:hover:not(:disabled) {
    background: var(--ct-bg-secondary);
}

/* Disabled state (applies to all variants) */
.ct-popup .menu_button:disabled,
.ct-settings-modal .menu_button:disabled,
.ct-drawer .menu_button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(0.5);
}

/* Active toggle state (for link/unlink buttons, etc.) */
.ct-popup .menu_button.ct-active,
.ct-settings-modal .menu_button.ct-active,
.ct-drawer .menu_button.ct-active {
    color: var(--ct-accent);
    background: var(--ct-accent-muted);
    border-color: var(--ct-accent);
}

.ct-popup .menu_button.ct-active:hover:not(:disabled),
.ct-settings-modal .menu_button.ct-active:hover:not(:disabled),
.ct-drawer .menu_button.ct-active:hover:not(:disabled) {
    background: color-mix(in srgb, var(--ct-accent) 40%, transparent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   BADGE VARIANTS - Additional modifiers
   ───────────────────────────────────────────────────────────────────────────── */

.ct-badge--small {
    padding: 0.1em 0.4em;
    font-size: 0.65rem;
}

.ct-badge--info {
    background: var(--ct-accent-muted);
    color: var(--ct-accent);
}

.ct-badge--muted {
    background: var(--ct-bg-tertiary);
    color: var(--ct-text-dim);
}

/* ─────────────────────────────────────────────────────────────────────────────
   COLLAPSIBLE DETAILS
   ───────────────────────────────────────────────────────────────────────────── */

.ct-collapsible {
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-sm);
}

.ct-collapsible summary {
    padding: var(--ct-space-2) var(--ct-space-3);
    cursor: pointer;
    font-size: var(--ct-text-sm);
    color: var(--ct-text-muted);
    background: var(--ct-bg-tertiary);
    user-select: none;
}

.ct-collapsible summary:hover {
    color: var(--ct-text);
}

.ct-collapsible summary::-webkit-details-marker {
    margin-right: var(--ct-space-2);
}

.ct-collapsible__content {
    padding: var(--ct-space-3);
    font-size: var(--ct-text-sm);
    color: var(--ct-text-muted);
    max-height: 150px;
    overflow-y: auto;
}

/* ─────────────────────────────────────────────────────────────────────────────
   KEYBOARD SHORTCUTS
   ───────────────────────────────────────────────────────────────────────────── */

.ct-shortcuts {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-shortcut {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
}

.ct-shortcut kbd {
    display: inline-flex;
    align-items: center;
    padding: 0.2em 0.5em;
    font-family: var(--ct-font);
    font-size: var(--ct-text-xs);
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius-sm);
}

.ct-shortcut__desc {
    color: var(--ct-text-muted);
}

/* =============================================================================
   5. RESPONSIVE OVERRIDES
   =============================================================================
   Mobile-first means base styles are mobile. These add desktop enhancements.
   ============================================================================= */

/* Touch-friendly tap targets on mobile */
@media (max-width: 768px) {
    .ct-popup .menu_button {
        min-height: 44px;
        padding: var(--ct-space-3);
    }

    .ct-tab {
        min-height: 44px;
    }

    .ct-list-item {
        padding: var(--ct-space-4);
    }

    /* Always show action buttons on mobile (no hover) */
    .ct-list-item__actions {
        opacity: 1;
    }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    .ct-popup *,
    .ct-popup *::before,
    .ct-popup *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .ct-popup {
        --ct-border: var(--ct-text);
        --ct-border-muted: var(--ct-text-muted);
    }
}

/* =============================================================================
   6. PRESET DRAWER
   =============================================================================
   Slideout panel for preset editing. Positioned absolute within the ST popup
   dialog to stay in the browser's top layer stacking context.
   ============================================================================= */

/* Drawer container - absolute within popup dialog */
.ct-drawer {
    position: absolute;
    inset: 0;
    z-index: 100; /* Above popup content but within dialog */
    pointer-events: none;
    overflow: hidden;
}

.ct-drawer[aria-hidden='true'] {
    visibility: hidden;
}

.ct-drawer--open {
    pointer-events: auto;
    visibility: visible;
}

/* Backdrop with fade animation */
.ct-drawer__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    opacity: 0;
    transition: opacity var(--ct-transition);
    backdrop-filter: blur(4px);
}

.ct-drawer--open .ct-drawer__backdrop {
    opacity: 1;
}

/* Panel slides in from right */
.ct-drawer__panel {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    max-width: 640px;
    background: var(--SmartThemeBlurTintColor, var(--ct-bg));
    border-left: 1px solid var(--ct-border);
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.4);
    transform: translateX(100%);
    transition: transform var(--ct-transition);
    display: flex;
    flex-direction: column;
}

.ct-drawer--open .ct-drawer__panel {
    transform: translateX(0);
}

/* On mobile, full width */
@media (max-width: 768px) {
    .ct-drawer__panel {
        max-width: none;
    }
}

/* Drawer content layout */
.ct-drawer__content {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
}

/* Header */
.ct-drawer__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ct-space-3) var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border-bottom: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
}

.ct-drawer__title {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-drawer__title h3 {
    margin: 0;
    font-size: var(--ct-text-lg);
    font-weight: 600;
}

.ct-drawer__title i {
    font-size: var(--ct-text-base);
}

/* Body */
.ct-drawer__body {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: var(--ct-space-4);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-4);
}

/* Footer */
.ct-drawer__footer {
    display: flex;
    align-items: center;
    padding: var(--ct-space-3) var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border-top: 1px solid var(--ct-border-muted);
    flex-shrink: 0;
}

/* =============================================================================
   STAGE CHIPS - Compact stage selection
   ============================================================================= */

.ct-stage-chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--ct-space-2);
}

.ct-chip {
    display: inline-flex;
    align-items: center;
    gap: var(--ct-space-1);
    padding: var(--ct-space-1) var(--ct-space-3);
    font-size: var(--ct-text-sm);
    color: var(--ct-text-muted);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border-muted);
    border-radius: var(--ct-radius-pill);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
    user-select: none;
}

.ct-chip:hover {
    border-color: var(--ct-border);
    color: var(--ct-text);
}

.ct-chip--active {
    color: var(--ct-accent);
    background: var(--ct-accent-muted);
    border-color: var(--ct-accent);
}

.ct-chip input[type='checkbox'] {
    display: none;
}

/* =============================================================================
   EDITOR COMPONENTS
   ============================================================================= */

/* Editor wrapper for prompt textarea */
.ct-editor-wrap {
    position: relative;
    flex: 1;
    min-height: 200px;
}

.ct-textarea--editor {
    width: 100%;
    height: 100%;
    min-height: 200px;
    resize: vertical;
    font-family: var(--ct-font);
    font-size: var(--ct-text-sm);
    line-height: 1.6;
}

/* Editor toolbar */
.ct-editor-toolbar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-border-muted);
    border-bottom: none;
    border-radius: var(--ct-radius) var(--ct-radius) 0 0;
}

.ct-toolbar-divider {
    width: 1px;
    height: 1.5em;
    background: var(--ct-border-muted);
    margin: 0 var(--ct-space-1);
}

/* Code editor with syntax highlighting */
.ct-code-editor {
    position: relative;
    flex: 1;
    min-height: 250px;
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
    border: 1px solid var(--ct-border);
    border-top: none;
    border-radius: 0 0 var(--ct-radius) var(--ct-radius);
    overflow: hidden;
}

.ct-code-editor__highlight,
.ct-code-editor__textarea {
    position: absolute;
    inset: 0;
    margin: 0;
    padding: var(--ct-space-3);
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: auto;
}

.ct-code-editor__highlight {
    pointer-events: none;
    background: var(--ct-bg-secondary);
    color: var(--ct-text);
}

.ct-code-editor__highlight code {
    font-family: inherit;
    background: transparent;
}

.ct-code-editor__textarea {
    background: transparent;
    color: transparent;
    caret-color: var(--ct-text);
    resize: none;
    border: none;
    outline: none;
    z-index: 1;
}

.ct-code-editor__textarea::selection {
    background: var(--ct-accent-muted);
}

/* Syntax highlighting colors (using hljs classes) */
.ct-code-editor .hljs-string {
    color: var(--ct-success);
}

.ct-code-editor .hljs-number {
    color: var(--ct-warning);
}

.ct-code-editor .hljs-literal {
    color: var(--ct-accent);
}

.ct-code-editor .hljs-attr {
    color: var(--ct-text);
}

.ct-code-editor .hljs-punctuation {
    color: var(--ct-text-muted);
}

/* Form group that grows to fill space */
.ct-form-group--grow {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

/* =============================================================================
   DRAWER BUTTONS
   =============================================================================
   NOTE: Button styles for drawer are now consolidated in the "BUTTON VARIANTS"
   section above. This section is kept for any drawer-specific overrides.
   ============================================================================= */

/* =============================================================================
   PRESET MANAGEMENT BUTTON - Trigger for drawer
   ============================================================================= */

.ct-preset-manage {
    display: inline-flex;
    align-items: center;
    gap: var(--ct-space-1);
    padding: var(--ct-space-1);
    color: var(--ct-text-muted);
    background: transparent;
    border: none;
    border-radius: var(--ct-radius-sm);
    cursor: pointer;
    transition: all var(--ct-transition-fast);
}

.ct-preset-manage:hover {
    color: var(--ct-accent);
    background: var(--ct-accent-muted);
}

/* =============================================================================
   ENHANCED PRESET DROPDOWN ROW
   ============================================================================= */

.ct-preset-row {
    display: flex;
    align-items: center;
    gap: var(--ct-space-2);
}

.ct-preset-row .ct-select {
    flex: 1;
    min-width: 0;
}

.ct-preset-row__actions {
    display: flex;
    gap: var(--ct-space-1);
    flex-shrink: 0;
}

/* =============================================================================
   EXTENSION PANEL - Settings panel in ST Extensions section
   ============================================================================= */

.ct-panel-version {
    color: var(--SmartThemeEmColor, #999);
    font-size: 0.85em;
    margin-bottom: 0.5em;
}

.ct-panel-desc {
    margin: 0 0 1em 0;
    font-size: 0.9em;
    color: var(--SmartThemeBodyColor);
    line-height: 1.4;
}

.ct-panel-actions {
    display: flex;
    gap: 0.5em;
}

.ct-panel-actions .menu_button {
    flex: 1;
}

/* =============================================================================
   HYBRID RESPONSE FORMATTER - Premium Results Display
   ============================================================================= */

/* Score color tokens */
:root {
    --ct-score-high: #10b981;
    --ct-score-good: #22c55e;
    --ct-score-mid: #eab308;
    --ct-score-low: #f97316;
    --ct-score-bad: #ef4444;
}

/* Main formatted container */
.ct-formatted {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
    font-size: var(--ct-text-sm);
    line-height: 1.55;
}

.ct-formatted--empty {
    padding: var(--ct-space-4);
    text-align: center;
    color: var(--ct-text-dim);
    font-style: italic;
}

/* ─────────────────────────────────────────────────────────────────────────────
   HERO SCORE - Compact prominent score display
   ───────────────────────────────────────────────────────────────────────────── */

.ct-hero {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--ct-space-3) var(--ct-space-4);
    background: linear-gradient(
        135deg,
        var(--ct-bg-secondary) 0%,
        var(--ct-bg-tertiary) 100%
    );
    border-radius: var(--ct-radius);
    border: 1px solid var(--ct-border);
    text-align: center;
    overflow: hidden;
}

/* Subtle glow effect behind score */
.ct-hero::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    background: var(--score-color, var(--ct-accent));
    opacity: 0.06;
    filter: blur(30px);
    border-radius: 50%;
    pointer-events: none;
}

.ct-hero__label {
    font-size: var(--ct-text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--ct-text-muted);
    margin-bottom: var(--ct-space-1);
}

.ct-hero__score {
    display: flex;
    align-items: baseline;
    gap: 2px;
}

.ct-hero__value {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1;
    color: var(--score-color, var(--ct-accent));
    text-shadow: 0 2px 12px
        color-mix(
            in srgb,
            var(--score-color, var(--ct-accent)) 25%,
            transparent
        );
    font-variant-numeric: tabular-nums;
}

.ct-hero__max {
    font-size: 1rem;
    font-weight: 500;
    color: var(--ct-text-dim);
    margin-left: 2px;
}

/* Score progress bar */
.ct-hero__bar {
    width: 100%;
    max-width: 160px;
    height: 4px;
    margin-top: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-radius: 2px;
    overflow: hidden;
}

.ct-hero__fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SECTIONS - Content groups with headers
   ───────────────────────────────────────────────────────────────────────────── */

.ct-section {
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius);
    overflow: hidden;
}

.ct-section__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-2);
    padding: var(--ct-space-2) var(--ct-space-3);
    background: var(--ct-bg-tertiary);
    border-bottom: 1px solid var(--ct-border-muted);
}

.ct-section__title {
    margin: 0;
    font-size: var(--ct-text-sm);
    font-weight: 700;
    color: var(--ct-text);
}

.ct-section__score {
    display: inline-flex;
    align-items: baseline;
    padding: 2px 8px;
    background: color-mix(
        in srgb,
        var(--score-color, var(--ct-accent)) 15%,
        transparent
    );
    border-radius: var(--ct-radius-sm);
    font-weight: 700;
    font-size: var(--ct-text-sm);
    color: var(--score-color, var(--ct-accent));
    font-variant-numeric: tabular-nums;
}

.ct-section__score-max {
    font-size: 0.8em;
    font-weight: 500;
    opacity: 0.6;
    margin-left: 1px;
}

.ct-section__body {
    padding: var(--ct-space-3);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-section__body--nested {
    background: var(--ct-bg);
    border-left: 2px solid var(--ct-accent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   FIELDS - Key/value pairs
   ───────────────────────────────────────────────────────────────────────────── */

.ct-field {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-field__label {
    font-size: var(--ct-text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--ct-text-muted);
}

.ct-field__value {
    font-size: var(--ct-text-sm);
    line-height: 1.6;
    color: var(--ct-text);
}

.ct-field--empty {
    color: var(--ct-text-dim);
    font-style: italic;
}

/* ─────────────────────────────────────────────────────────────────────────────
   PARAGRAPHS - Body text
   ───────────────────────────────────────────────────────────────────────────── */

.ct-para {
    margin: 0;
    font-size: var(--ct-text-sm);
    line-height: 1.6;
    color: var(--ct-text);
}

.ct-para + .ct-para {
    margin-top: var(--ct-space-1);
}

.ct-text {
    font-size: var(--ct-text-sm);
    line-height: 1.6;
    white-space: pre-wrap;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LISTS - Bullet and numbered lists
   ───────────────────────────────────────────────────────────────────────────── */

.ct-list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.ct-list li {
    position: relative;
    padding-left: var(--ct-space-3);
    font-size: var(--ct-text-sm);
    line-height: 1.5;
}

.ct-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.55em;
    width: 5px;
    height: 5px;
    background: var(--ct-accent);
    border-radius: 50%;
    opacity: 0.7;
}

/* Numbered variant */
.ct-list--numbered {
    counter-reset: list-counter;
}

.ct-list--numbered li {
    counter-increment: list-counter;
    padding-left: var(--ct-space-5);
}

.ct-list--numbered li::before {
    content: counter(list-counter);
    width: auto;
    height: auto;
    background: none;
    border-radius: 0;
    font-size: var(--ct-text-xs);
    font-weight: 700;
    color: var(--ct-accent);
    opacity: 1;
    top: 0;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CARDS - Complex items in arrays
   ───────────────────────────────────────────────────────────────────────────── */

.ct-cards {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-3);
}

.ct-card {
    padding: var(--ct-space-4);
    background: var(--ct-bg-secondary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius);
    transition:
        border-color var(--ct-transition-fast),
        box-shadow var(--ct-transition-fast);
}

.ct-card:hover {
    border-color: var(--ct-border-active);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.ct-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--ct-space-3);
    margin-bottom: var(--ct-space-3);
}

.ct-card__title {
    font-weight: 700;
    font-size: var(--ct-text-base);
    color: var(--ct-text);
}

.ct-card__body {
    font-size: var(--ct-text-sm);
    line-height: 1.7;
    color: var(--ct-text-secondary);
}

.ct-card__extra {
    margin-top: var(--ct-space-3);
    padding-top: var(--ct-space-3);
    border-top: 1px solid var(--ct-border-muted);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

/* ─────────────────────────────────────────────────────────────────────────────
   SCORES - Inline and badge scores
   ───────────────────────────────────────────────────────────────────────────── */

.ct-score {
    display: inline-flex;
    align-items: baseline;
    padding: 2px 8px;
    background: color-mix(
        in srgb,
        var(--score-color, var(--ct-accent)) 15%,
        transparent
    );
    border-radius: var(--ct-radius-sm);
    font-weight: 700;
    font-size: var(--ct-text-sm);
    color: var(--score-color, var(--ct-accent));
    font-variant-numeric: tabular-nums;
}

.ct-score__max {
    font-size: 0.75em;
    font-weight: 500;
    opacity: 0.6;
    margin-left: 1px;
}

/* Inline score (within text) */
.ct-inline-score {
    display: inline-flex;
    align-items: baseline;
    padding: 1px 6px;
    margin: 0 2px;
    background: color-mix(
        in srgb,
        var(--score-color, var(--ct-accent)) 12%,
        transparent
    );
    border-radius: 4px;
    font-weight: 700;
    font-size: 0.95em;
    color: var(--score-color, var(--ct-accent));
    font-variant-numeric: tabular-nums;
}

.ct-inline-score__label {
    font-weight: 500;
    color: var(--ct-text-muted);
    margin-right: 2px;
}

.ct-inline-score__max {
    font-size: 0.75em;
    font-weight: 500;
    opacity: 0.5;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CODE BLOCKS
   ───────────────────────────────────────────────────────────────────────────── */

.ct-code {
    position: relative;
    background: var(--ct-bg-tertiary);
    border: 1px solid var(--ct-border);
    border-radius: var(--ct-radius);
    overflow: hidden;
}

.ct-code__lang {
    position: absolute;
    top: var(--ct-space-2);
    right: var(--ct-space-2);
    padding: 2px 8px;
    background: var(--ct-bg-secondary);
    border-radius: var(--ct-radius-sm);
    font-size: var(--ct-text-xs);
    font-weight: 600;
    color: var(--ct-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.ct-code__pre {
    margin: 0;
    padding: var(--ct-space-4);
    overflow-x: auto;
    font-family: var(--ct-font-mono);
    font-size: var(--ct-text-xs);
    line-height: 1.6;
}

.ct-code__pre code {
    font-family: inherit;
}

/* Inline code */
.ct-inline-code {
    padding: 2px 6px;
    background: var(--ct-bg-tertiary);
    border-radius: 4px;
    font-family: var(--ct-font-mono);
    font-size: 0.9em;
    color: var(--ct-accent);
}

/* ─────────────────────────────────────────────────────────────────────────────
   BOOLEANS
   ───────────────────────────────────────────────────────────────────────────── */

.ct-bool--yes {
    display: inline-flex;
    align-items: center;
    gap: var(--ct-space-1);
    color: var(--ct-success);
    font-weight: 600;
}

.ct-bool--no {
    display: inline-flex;
    align-items: center;
    gap: var(--ct-space-1);
    color: var(--ct-danger);
    font-weight: 600;
}

.ct-bool--yes i,
.ct-bool--no i {
    font-size: 1.1em;
}

/* ─────────────────────────────────────────────────────────────────────────────
   UTILITY CLASSES
   ───────────────────────────────────────────────────────────────────────────── */

.ct-null {
    color: var(--ct-text-dim);
}

.ct-empty {
    color: var(--ct-text-dim);
    font-style: italic;
}

.ct-num {
    font-family: var(--ct-font-mono);
    font-weight: 600;
    font-variant-numeric: tabular-nums;
}

.ct-link {
    color: var(--ct-accent);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--ct-transition-fast);
}

.ct-link:hover {
    border-bottom-color: var(--ct-accent);
}

/* Strong/emphasis in formatted content */
.ct-formatted strong {
    font-weight: 700;
    color: var(--ct-text);
}

.ct-formatted em {
    font-style: italic;
    color: var(--ct-text-secondary);
}

/* ─────────────────────────────────────────────────────────────────────────────
   LEGACY SUPPORT (deprecated, kept for compatibility)
   ───────────────────────────────────────────────────────────────────────────── */

.ct-structured {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-3);
}

.ct-sf {
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-sf__label {
    font-size: var(--ct-text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--ct-text-muted);
}

.ct-sf__value {
    font-size: var(--ct-text-sm);
    line-height: 1.5;
}

.ct-sf--empty,
.ct-sf--null {
    color: var(--ct-text-dim);
    font-style: italic;
}

.ct-sf--nested {
    padding-left: var(--ct-space-3);
    border-left: 2px solid var(--ct-border-muted);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-2);
}

.ct-sf__list {
    margin: 0;
    padding-left: var(--ct-space-4);
    display: flex;
    flex-direction: column;
    gap: var(--ct-space-1);
}

.ct-sf__list li {
    font-size: var(--ct-text-sm);
}

.ct-sf__num {
    font-family: var(--ct-font-mono);
    font-weight: 500;
}

.ct-sf__text {
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    font-size: var(--ct-text-sm);
    line-height: 1.5;
}

.ct-json {
    margin: 0;
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    overflow-x: auto;
    font-size: var(--ct-text-xs);
}

/* Legacy markdown content */
.ct_markdown_content {
    font-size: var(--ct-text-sm);
    line-height: 1.6;
}

.ct_markdown_content h1,
.ct_markdown_content h2,
.ct_markdown_content h3 {
    margin-top: var(--ct-space-3);
    margin-bottom: var(--ct-space-2);
}

.ct_markdown_content p {
    margin: var(--ct-space-2) 0;
}

.ct_markdown_content ul,
.ct_markdown_content ol {
    margin: var(--ct-space-2) 0;
    padding-left: var(--ct-space-4);
}

.ct_markdown_content code {
    padding: 0.1em 0.3em;
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    font-family: var(--ct-font-mono);
    font-size: 0.9em;
}

.ct_markdown_content pre {
    margin: var(--ct-space-2) 0;
    padding: var(--ct-space-2);
    background: var(--ct-bg-tertiary);
    border-radius: var(--ct-radius-sm);
    overflow-x: auto;
}

.ct_markdown_content pre code {
    padding: 0;
    background: none;
}
